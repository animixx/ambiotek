<?php

namespace Eye3\CaminosBundle\Entity;
use Doctrine\ORM\EntityRepository;


use Eye3\CaminosBundle\Entity\Sightdata;

/**
 * SightdataRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class SightdataRepository extends EntityRepository
{

		public function GetMedicion($tipo=true)
		{
			if ($tipo)
			{
				$query = $this->getEntityManager()
				->getConnection()
				->prepare(
					'select avg(tsplat) as tpm, avg(pm10lat) as pm10, avg(pm25lat) as pm25, avg(pm1lat) as pm1, id_tramo as id from pmdata group by id_tramo having id_tramo is not null  '
				);
			}
			else
			{
				$query = $this->getEntityManager()
				->getConnection()
				->prepare(
					'SELECT * FROM pmdata join gpsdata on id_gps=id '
				);
			}
			$query->execute();

			return $query->fetchAll();
		}
		
		public function GetSightDots($fecha = "031214")
		{
			$query = $this->getEntityManager()
				->createQuery(
					'SELECT dato FROM Eye3CaminosBundle:Sightdata dato where dato.date = :fecha'
				)->setParameter('fecha', $fecha);;

			try {
				return $query->getResult();
			} catch (\Doctrine\ORM\NoResultException $e) {
				return null;
			}
			 
		}

}
		
